#summary Instructions on how to configure Sylverant Ship Server and how files should be laid out.
#labels Phase-Deploy

= Introduction =

Sylverant has various files that must be set up to configure the various parts of the Sylverant server. Generally, all Sylverant-related files are placed in /usr/local/share/sylverant (henceforth assumed to be in front of any paths), but this can be configured when you compile libsylverant.

= Configuring Sylverant Ship Server =

The base configuration file for configuring the Ship Server is called ship_config.xml, and is placed in the config directory. This file can be used to configure multiple ships per instance of Ship Server, but this functionality has not been thoroughly tested. The layout of this file is as follows:

{{{
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE ships PUBLIC "-//Sylverant//DTD Ship Configuration 1.1//EN"
  "http://sylverant.net/dtd/ship_config1.1/ship_config.dtd">

<ships>
    <shipgate ip="Shipgate IP" port="Shipgate Port"/>
    <ship name="Ship Name" blocks="Number of blocks" key="Keyfile" gms="GM File" menu="Menu Code" gmonly="Enable GM Only Mode">
        <net port="Base Ship Port" ip="Ship IP" />
        <event lobby="Lobby Event Code" game="Game Event Code" />
        <info file="Filename" desc="Description" />
        <quests file="Quest File" />
        <limits file="Item List" />
        <motd file="Message of the Day File" />
    </ship>
</ships>
}}}

The various fields are explained below:
  * Shipgate IP: The IP Address of the Shipgate to connect to.
  * Shipgate Port: The port to connect to the Shipgate on. Currently this must be 3455.
  * Ship Name: The name you wish to call your ship. This should be less than 16 characters in length.
  * Number of blocks: Obvious.
  * Keyfile: An encryption key provided by the owner of the Shipgate.
  * GM File: The XML file to configure the list of GMs for this ship (described below)
  * Menu Code: The submenu of the shipgate to put this ship in. Unless the ship has been specially set up in the Database (the main_menu column of the ship_data table has been set to non-zero), this must be a valid 2 alphabetic character code. Basically, this _should_ be the two-character country code of the location of the ship, but this isn't strictly enforced. This should be omitted if the ship is to appear in the main menu of the shipgate.
  * Enable GM Only mode: Set this to either "true" or "false" (default is false if its omitted) to limit the ship to only being able to be accessed by Global GMs.
  * Base Ship Port: The port to start allocating ports for ship connections. The program will allocate (number of blocks + 1) `*` 2 ports currently, and this is subject to change.
  * Ship IP: The publicly accessible IP address for the ship.
  * Lobby Event Code: Set the event that's shown in the lobby. Lobby events aren't supported on PSODC/PSOPC. Valid values are 0-14.
  * Game Event Code: Set the event that's shown in games. These, unlike lobby events, are supported on all versions of PSO. Valid values are 0-6.
  * Info: The text shown at the lobby counter when the user selects the Information option. You can have multiple files here. The file itself should be a normal UTF-8 text file, and the description should be less than 16 characters in length. I suggest placing the information files in a "info" directory off the top of the sylverant directory, but that's not a strict requirement. These only work on PSODC/PSOPC since the Information option doesn't exist on PSOGC.
  * Quest File: The list of quests that are available on the server (described below).
  * Item List: The list of items that are to be used for /legit. See the legits.xml in the ship_server for a full example of how to set it up.
  * Message of the Day File: A text file that is used to send a message to clients when they connect. These messages currently will show up for Dreamcast and PC clients when they join the lobby, whereas they'll show up for Gamecube clients before they can select the block to join. Keep the messages fairly short, as there's no way to scroll them on PSODC/PSOPC (they appear in the same large message box as the info desk entries).

== GM Configuration ==

The GM configuration file is a simple XML list of serial number/access key/guildcard sets for the users that should have GM permissions on the ship. I call the file iselia_gms.xml for the Iselia ship, but once again, this is configurable in the ship_config.xml file above.

{{{
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE gms PUBLIC "-//Sylverant//DTD Ship GM List 1.0//EN" 
  "http://sylverant.net/dtd/gms1/gms.dtd">

<gms>
    <gm serial="Serial Number" accesskey="Access Key" guildcard="Guild Card" />
</gms>
}}}

For each person in the list, you must place each element in its prescribed place. You can provide multiple GMs in the file (and probably will). The pieces in and of themselves are self explanatory.

== Quest Configuration ==

The Quest configuration file is an XML list of categories/quests that are available on your ship. An example is shown below. 

{{{
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE quests PUBLIC "-//Sylverant//DTD Quest List 1.0//EN" 
  "http://sylverant.net/dtd/quests1/quests.dtd">

<quests>
    <category name="VR">
        <description>These are quests
where you battle
enemies in a
virtual room.</description>
        <quest name="Towards the Future" prefix="q118" v1="false" v2="true"
         gc="false" bb="false">
            <short>The enemy simulator
is complete.
Challenge the other
hunters.</short>
            <long>Client:  Principal
Quest:
 The enemy simulator is complete.
 Challenge the other hunters.
Reward:  ??? Meseta</long>
        </quest>
    </category>
</quests>
}}}

You can configure multiple categories, and multiple quests per category. In this case, only one category, with one quest has been configured. The quest itself will be in the quests subdirectory of the Sylverant directory. In this case, only PSOv2 (and PSOPC) are supported. A quest that is supported in v2 must be supported in PSOPC at the moment. All the others are independent. The files for this quest would be called q118v2.dat, q118v2.bin, q118pc.dat, q118pc.bin. These quests are in what Qedit refers to as Kohle basic layout. Version 1 quests will end with v1, Version 2 will end with v2, PC will end with pc, and so forth. Hopefully everything else should be obvious.